# thinkt - AI Coding Session Explorer

This document is for AI assistants and LLMs to understand how to use thinkt tools effectively.

## What is thinkt?

thinkt provides tools for exploring and extracting data from AI coding assistant sessions. It reads session files from Claude Code, Kimi Code, Gemini CLI, and GitHub Copilot CLI, providing unified access through CLI, REST API, and MCP.

## Repository Structure

```
/cmd/thinkt/          - CLI application entry point
/internal/thinkt/     - Core library (stores, parsers, types)
/internal/server/     - HTTP server and MCP server
/internal/tui/        - Terminal UI components
/docs/hugo/content/   - Documentation (markdown)
```

## Key Documentation Files

- `/docs/hugo/content/cli.md` - CLI guide with examples
- `/docs/hugo/content/rest-api.md` - REST API endpoints and usage
- `/docs/hugo/content/mcp-server.md` - MCP tools and client configuration
- `/docs/hugo/content/docker.md` - Docker usage for sandboxed access
- `/docs/hugo/content/serve-lite.md` - Lightweight web interface
- `/internal/server/docs/swagger.yaml` - OpenAPI specification

## Session Data Locations

| Source | Default Path |
|--------|--------------|
| Claude Code | `~/.claude/projects/` |
| Kimi Code | `~/.kimi/workspace/` |
| Gemini CLI | `~/.gemini/` |
| Copilot CLI | `~/.config/github-copilot/` |

Sessions are stored as JSONL files with conversation entries.

---

## Using thinkt via CLI

### List and Explore

```bash
# List all projects across all sources
thinkt projects
thinkt projects --long              # Detailed view
thinkt projects --source claude     # Filter by source

# List sessions for a project
thinkt sessions list -p /path/to/project

# View a session
thinkt sessions view <session-id>

# Search across all sessions
thinkt search "authentication"
thinkt search -p /path/to/project "error handling"
```

### Statistics

```bash
thinkt stats tokens                 # Token usage
thinkt stats tools                  # Tool usage frequency
thinkt stats activity --days 7      # Activity timeline
thinkt stats models                 # Model usage breakdown
```

### Raw SQL Queries

```bash
thinkt query "SELECT COUNT(*) FROM read_json_auto('~/.claude/projects/*/*.jsonl')"
```

### Servers

```bash
thinkt serve                        # HTTP server on port 7433
thinkt serve lite                   # Lightweight debug UI on port 7434
thinkt serve mcp                    # MCP server on stdio
thinkt serve mcp --port 8081        # MCP server over HTTP
```

---

## Using thinkt via MCP

MCP (Model Context Protocol) allows AI assistants to query session data directly.

### Available MCP Tools

#### list_sources
List available trace sources.
- Input: none
- Output: `{sources: [{name, available, base_path}]}`

#### list_projects
List projects, optionally filtered by source.
- Input: `{source?: string}`
- Output: `{projects: [{id, name, path, session_count, source}]}`

#### list_sessions
List sessions for a project.
- Input: `{project_id: string}` (required)
- Output: `{sessions: [{id, path, created_at, modified_at, entry_count, file_size, source}]}`

#### get_session_metadata
Get session metadata without full content. Use this first to understand a session.
- Input: `{path: string}` (required, full path to session file)
- Output: `{meta, description, role_counts, entry_summary[], total_entries, total_content_bytes}`

Entry summary includes: `{index, role, timestamp, content_length, has_thinking, has_tool_use, has_tool_result, preview}`

#### get_session_entries
Get session entry content with pagination and filtering.
- Input:
  - `path: string` (required)
  - `limit?: int` (default: 5)
  - `offset?: int` (default: 0)
  - `entry_indices?: int[]` (specific entries to fetch)
  - `roles?: string[]` (filter by role)
  - `max_content_length?: int` (default: 500, truncation limit)
  - `include_thinking?: bool` (default: false)
- Output: `{entries[], has_more, total, returned}`

### MCP Best Practices

1. **Start with metadata**: Call `get_session_metadata` first to understand session structure
2. **Use pagination**: Default limit is 5 entries; use offset for more
3. **Filter by role**: Use `roles: ["user"]` to get just user prompts
4. **Request specific entries**: Use `entry_indices` to fetch specific entries by index
5. **Control content size**: Adjust `max_content_length` based on needs
6. **Thinking blocks**: Set `include_thinking: true` only when analyzing reasoning

---

## Using thinkt via REST API

Base URL: `http://localhost:7433/api/v1`

### Endpoints

```
GET  /sources                           - List sources
GET  /projects                          - List all projects
GET  /projects?source=claude            - Filter by source
GET  /projects/{projectID}/sessions     - List sessions (projectID is URL-encoded path)
GET  /sessions/{path}                   - Get session content
GET  /sessions/{path}?limit=10&offset=0 - Paginated
GET  /themes                            - List themes
GET  /open-in/apps                      - List open-in apps
POST /open-in                           - Open path in app
```

### Example: Fetch Session Content

```bash
# URL-encode the session path
path=$(python3 -c "import urllib.parse; print(urllib.parse.quote('/path/to/session.jsonl', safe=''))")
curl "http://localhost:7433/api/v1/sessions/$path?limit=10"
```

### Response Structure

Session response:
```json
{
  "meta": {"id", "full_path", "created_at", "modified_at", "entry_count", "model", "source"},
  "entries": [
    {
      "uuid": "...",
      "role": "user|assistant|tool|system",
      "timestamp": "...",
      "text": "...",
      "content_blocks": [
        {"type": "text", "text": "..."},
        {"type": "thinking", "thinking": "..."},
        {"type": "tool_use", "tool_use_id": "...", "tool_name": "...", "tool_input": {...}},
        {"type": "tool_result", "tool_use_id": "...", "tool_result": "...", "is_error": false}
      ],
      "model": "...",
      "usage": {"input_tokens", "output_tokens"}
    }
  ],
  "has_more": true,
  "total": 42
}
```

---

## Using thinkt as a Go Library

### Import

```go
import (
    "github.com/wethinkt/go-thinkt/internal/thinkt"
    "github.com/wethinkt/go-thinkt/internal/thinkt/claude"
    "github.com/wethinkt/go-thinkt/internal/thinkt/kimi"
)
```

### Discover Sources and List Projects

```go
discovery := thinkt.NewDiscovery(
    claude.Factory(),
    kimi.Factory(),
)
registry, err := discovery.Discover(ctx)

projects, err := registry.ListAllProjects(ctx)
for _, p := range projects {
    fmt.Printf("%s (%s): %d sessions\n", p.Path, p.Source, p.SessionCount)
}
```

### Load a Session

```go
store := registry.StoreFor(thinkt.SourceClaude)
sessions, err := store.ListSessions(ctx, projectID)

// Load session entries
session, err := store.LoadSession(ctx, sessions[0].FullPath)
for _, entry := range session.Entries {
    fmt.Printf("[%s] %s\n", entry.Role, entry.Text)
}
```

### Key Types

```go
type Entry struct {
    UUID          string
    Role          Role           // user, assistant, tool, system
    Text          string
    ContentBlocks []ContentBlock
    Timestamp     time.Time
    Model         string
    Usage         TokenUsage
}

type ContentBlock struct {
    Type       string      // text, thinking, tool_use, tool_result
    Text       string
    Thinking   string
    ToolUseID  string
    ToolName   string
    ToolInput  interface{}
    ToolResult string
    IsError    bool
}

type Role string
const (
    RoleUser      Role = "user"
    RoleAssistant Role = "assistant"
    RoleTool      Role = "tool"
    RoleSystem    Role = "system"
)
```

---

## Using thinkt via TypeScript/JavaScript

Use the REST API with fetch:

```typescript
const API_BASE = 'http://localhost:7433/api/v1';

// List projects
const projects = await fetch(`${API_BASE}/projects`).then(r => r.json());

// Get session content
const encodedPath = encodeURIComponent('/path/to/session.jsonl');
const session = await fetch(`${API_BASE}/sessions/${encodedPath}?limit=20`).then(r => r.json());

// Process entries
for (const entry of session.entries) {
  console.log(`[${entry.role}] ${entry.text?.slice(0, 100)}`);

  for (const block of entry.content_blocks || []) {
    if (block.type === 'tool_use') {
      console.log(`  Tool: ${block.tool_name}`);
    }
  }
}
```

---

## Common Tasks

### Find sessions about a topic
```bash
thinkt search "websocket implementation"
```

### Get token usage for a project
```bash
thinkt stats tokens -p /path/to/project
```

### Export session data
```bash
# Via CLI
thinkt sessions view <session-id> --json > session.json

# Via API
curl "http://localhost:7433/api/v1/sessions/$(urlencode /path/to/session.jsonl)" > session.json
```

### Find which tools were used most
```bash
thinkt stats tools --limit 20
```

### Get just user prompts from a session (MCP)
```json
{
  "tool": "get_session_entries",
  "input": {
    "path": "/path/to/session.jsonl",
    "roles": ["user"],
    "limit": 100
  }
}
```

---

## Data Model Summary

- **Source**: claude, kimi, gemini, copilot
- **Project**: A directory where AI assistant was used
- **Session**: A conversation (JSONL file with entries)
- **Entry**: A single message (user, assistant, tool, system)
- **ContentBlock**: Part of an entry (text, thinking, tool_use, tool_result)

## Tips for LLMs

1. **Use MCP when available**: It's the most direct integration path
2. **Prefer metadata first**: Check session size before loading full content
3. **Paginate large sessions**: Sessions can have hundreds of entries
4. **Filter by role**: Often you only need user or assistant messages
5. **Watch content length**: Set appropriate truncation limits
6. **Search is powerful**: `thinkt search` uses DuckDB for fast full-text search
7. **Stats provide insights**: Use stats commands to understand usage patterns
