# AGENTS: `go-thinkt`

## Project Overview

`go-thinkt` provides `thinkt`, a CLI tool for exploring and extracting data from AI coding assistant sessions. It is a companion to the [wethinkt](https://github.com/wethinkt/wethinkt) web visualization application.  Right now much is internal, but we will eventually build out a public package.

**Stack**: Go, Cobra (CLI), BubbleTea (TUI), DuckDB (analytics), Chi (HTTP), MCP SDK

Released under the MIT license, see [LICENSE.txt](./LICENSE.txt).

## Architecture

### Multi-Source Design

The tool supports multiple AI coding assistants via a `Store` interface:
- **Claude Code** (`~/.claude`) - Primary source
- **Kimi Code** (`~/.kimi`) - Secondary source
- **Gemini CLI** (`~/.gemini`) - Tertiary source
- **GitHub Copilot** (`~/.copilot`) - Quaternary source

Sources are auto-discovered. Use `--source kimi|claude|gemini|copilot` flags to filter.

### Key Packages

| Package | Purpose |
|---------|---------|
| `cmd/thinkt` | CLI entry point (Cobra commands) |
| `internal/thinkt` | Core types, Store interface, registry |
| `internal/sources/claude` | Claude Code storage implementation |
| `internal/sources/kimi` | Kimi Code storage implementation |
| `internal/sources/gemini` | Gemini CLI storage implementation |
| `internal/sources/copilot` | Copilot storage implementation |
| `internal/tui` | BubbleTea terminal UI |
| `internal/server` | HTTP REST API and MCP server |
| `internal/server/webapp` | Lite webapp (HTML/CSS/JS) |
| `internal/analytics` | DuckDB-powered search and stats |
| `internal/prompt` | Prompt extraction and formatting |
| `internal/config` | Configuration management |

### Command Structure

```
thinkt
├── tui                 # Interactive TUI browser (default)
├── serve               # HTTP/MCP servers
│   ├── mcp             # MCP server (stdio or HTTP)
│   └── lite            # Lightweight debug webapp
├── sources             # Source management
│   ├── list
│   └── status
├── projects            # Project management
│   ├── summary
│   ├── delete
│   └── copy
├── sessions            # Session management
│   ├── list
│   ├── summary
│   ├── view
│   ├── delete
│   └── copy
├── search              # Full-text search (DuckDB)
├── stats               # Analytics
│   ├── tokens
│   ├── tools
│   ├── words
│   ├── activity
│   ├── models
│   └── errors
├── query               # Raw SQL queries
├── prompts             # Prompt extraction
│   ├── extract
│   ├── list
│   ├── info
│   └── templates
└── theme               # Theme management
    ├── list
    ├── set
    └── builder
```

### Serve Command Flags

| Flag | Description |
|------|-------------|
| `--port, -p` | Server port (default: 7433 for serve, 7434 for lite) |
| `--host` | Server host (default: localhost) |
| `--no-open` | Don't auto-open browser |
| `--quiet, -q` | Suppress HTTP request logging |
| `--http-log <file>` | Write HTTP access log to file |
| `--log` | Write debug log to file |

### Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `THINKT_KIMI_HOME` | Kimi Code data directory | `~/.kimi` |
| `THINKT_CLAUDE_HOME` | Claude Code data directory | `~/.claude` |
| `THINKT_GEMINI_HOME` | Gemini CLI data directory | `~/.gemini` |
| `THINKT_COPILOT_HOME` | Copilot data directory | `~/.copilot` |

## Lite Webapp

The lightweight webapp (`thinkt serve lite`) is a single-page debug interface located at `internal/server/webapp/`.

### Structure

```
internal/server/webapp/
├── index.html          # Main HTML file
└── static/
    ├── style.css       # Stylesheet
    └── i18n.js         # Internationalization (EN/ES/ZH)
```

### Features

- **i18n**: Auto-detects browser language, supports English, Spanish, and Chinese
- **Connection Status**: Real-time ping every 10s with visual indicator
- **Source Visibility**: Eye icons to toggle source visibility in project list
- **Open-In Dropdown**: Split-button to open projects in configured apps
- **Language Selector**: EN/ES/中文 buttons in top-right corner

### Static File Serving

Files are embedded using Go's `//go:embed` directive in `internal/server/static.go`.

## Documentation Map

| File | Purpose | Editable |
|------|---------|----------|
| README.md | Human-readable project overview | Yes |
| AGENTS.md | Agent instructions (this file) | Yes |
| MEMORY.md | Long-term concepts and decisions | Yes |
| PLAN.md | Implementation planning | Yes |
| PROMPTS.md | Generated by tool or hook | **READ ONLY** |

### Research Reports

Persisted research reports are available in `etc/reports`.

| File | Topic |
|------|-------|
| [etc/reports/thinking-tracer.md](./etc/reports/thinking-tracer.md) | Architecture of the thinking-tracer visualization app |
| [etc/reports/go-patterns.md](./etc/reports/go-patterns.md) | Go project conventions |
| [etc/reports/CLAUDE_STRUCTURE.md](./etc/reports/CLAUDE_STRUCTURE.md) | Claude Code storage structure |
| [etc/reports/KIMI_STRUCTURE.md](./etc/reports/KIMI_STRUCTURE.md) | Kimi Code storage structure |
| [etc/reports/SESSION_STORAGE.md](./etc/reports/SESSION_STORAGE.md) | Session storage comparison |
| [etc/reports/ONTOLOGY_ANALYSIS.md](./etc/reports/ONTOLOGY_ANALYSIS.md) | Data model ontology |
| [etc/reports/COMPONENT_MODEL.md](./etc/reports/COMPONENT_MODEL.md) | Component architecture |

## Docker

Multi-platform Docker images (`linux/amd64`, `linux/arm64`) are published to `ghcr.io/wethinkt/thinkt`.

### Dockerfiles

Two Dockerfiles exist:

| File | Purpose |
|------|---------|
| `Dockerfile` | Multi-stage build for CI and local use. Builds binary from source. |
| `Dockerfile.goreleaser` | Simple runtime image for GoReleaser. Uses pre-built cross-compiled binary. |

Both use `debian:bookworm-slim` runtime (required for glibc/CGO compatibility with DuckDB).

- Runs as non-root user `thinkt` (uid 5454)
- Home directory: `/data` (so `~/.claude` → `/data/.claude`)
- Entrypoint: `thinkt` (requires subcommand)

### Building

- **CI/Local**: Uses `Dockerfile` with multi-stage build (golang → debian-slim)
- **Release**: Uses `Dockerfile.goreleaser` with `goreleaser-cross` for CGO cross-compilation. See `.goreleaser.yml`.

### Usage

```bash
# Bind-mount session directories (paths resolve automatically via $HOME=/data)
docker run -p 7433:7433 \
  -v ~/.claude:/data/.claude:ro \
  -v ~/.kimi:/data/.kimi:ro \
  ghcr.io/wethinkt/thinkt:latest serve --host 0.0.0.0
```

## Development

```bash
task build      # Build binary to ./bin/thinkt
task test       # Run tests
task lint       # Run linter
task install    # Install to GOPATH/bin
```

### Adding a New Source

1. Create package in `internal/sources/<name>/`
2. Implement `thinkt.Store` interface
3. Add `Factory()` function returning `thinkt.StoreFactory`
4. Register in `cmd/thinkt/main.go` `createSourceRegistry()`
5. Add environment variable support if needed
