# CLI/TUI Internationalization (i18n) Implementation Plan

**Status:** Tasks 1–9 COMPLETE. All user-facing TUI strings i18n'd. `thinkt language` command tree with get/set/list subcommands, `--json` support, and TUI picker implemented.

**Goal:** Add i18n support to the thinkt CLI and TUI so all user-facing strings can be translated, starting with English as the default language and a foundation that makes adding new languages trivial.

**Architecture:** Use `nicksnyder/go-i18n/v2` with a package-level singleton localizer (matching the existing `theme.Current()` pattern). All user-facing strings get message IDs and default English values defined inline at the call site. Translation files live in `locales/` as embedded TOML. Locale is configured via `~/.thinkt/config.json` and `LANG`/`LC_ALL` environment variables.

**Tech Stack:** `github.com/nicksnyder/go-i18n/v2/i18n`, `golang.org/x/text/language`, `github.com/BurntSushi/toml` (for translation file format), `embed` (for bundling translations into the binary).

---

## Scope & String Inventory

| Area | Approx. strings | Status |
|------|-----------------|--------|
| Cobra commands (`.Short`, `.Long`, flags) | ~180 | DONE (Task 6) — tree walk localizes at startup |
| TUI labels, help, status | ~120 | DONE (Tasks 4, 9+) — all files i18n'd |
| CLI output (`fmt.Printf`, tables) | ~140 | DONE (Task 5) — server, sources, apps, teams, theme |
| Error messages | ~55 (user-facing) | DONE (Task 7) — prompts and errors wrapped |
| Relative time strings | ~12 | DONE (Task 3) — consolidated into `i18n.RelativeTime()` |
| **Total** | **~500** | **COMPLETE** |

## Design Decisions

### 1. Message ID Convention

Dot-separated hierarchical IDs matching the package/component:

```
cmd.root.short           = "Tools for AI assistant session exploration"
cmd.sessions.list.short  = "List sessions"
tui.shell.selectProject  = "Select project..."
tui.filter.user          = "User"
tui.help.scrollUp        = "scroll up"
cli.error.noProject      = "No project detected..."
common.loading           = "Loading..."
common.time.justNow      = "just now"
```

### 2. Locale Resolution Order

1. `THINKT_LANG` env var (explicit override)
2. `config.json` `"language"` field
3. `LANG` / `LC_ALL` / `LC_MESSAGES` env vars (OS default)
4. Fall back to `en`

### 3. Translation File Format

TOML, embedded via `//go:embed`. One file per language:

```
internal/i18n/locales/
  en.toml        # extracted from source (authoritative)
  zh-Hans.toml   # Simplified Chinese (~160 translated keys)
```

### 4. Cobra Command i18n Strategy

**Chosen: Option A (lazy)** — A single `localizeCommands()` function walks the command tree after `i18n.Init()` and localizes all Short/Long descriptions. Less invasive than deferred init.

### 5. Pluralization

Uses go-i18n's built-in CLDR plural rules for:
- `"%d sessions"`, `"%d projects"`, `"%d matches"`
- Relative time: `"%d mins ago"`, `"%d hours ago"`, `"%d days ago"`

### 6. What NOT to Translate

- Command names (`thinkt`, `sessions`, `list`) — API surface
- Flag names (`--verbose`, `--format`)
- Template variable names
- Log messages (internal)
- JSON field names
- Brand name "thinkt"

---

## Tasks

### Task 1: Add go-i18n dependency and create `internal/i18n` package ✅

**Files created/modified:**
- `internal/i18n/i18n.go` — `Init()`, `T()`, `Tf()`, `Tn()`, `ResolveLocale()`, `normalizeLocale()`
- `internal/i18n/i18n_test.go` — tests for T, Tn, fallback behavior
- `internal/i18n/locales/en.toml` — empty default locale
- `go.mod` — added `go-i18n/v2`, `BurntSushi/toml`, `golang.org/x/text`

**Commit:** `feat(i18n): add i18n package with go-i18n, T/Tf/Tn helpers`

---

### Task 2: Add `Language` field to config and initialize i18n at startup ✅

**Files modified:**
- `internal/config/config.go` — added `Language string` field
- `internal/cmd/root.go` — init i18n in `Execute()` before cobra runs

**Commit:** `feat(i18n): add Language config field, init i18n at startup`

---

### Task 3: Internationalize relative time strings (consolidate + i18n) ✅

**Files created/modified:**
- `internal/i18n/reltime.go` — `RelativeTime()`, `RelativeTimeShort()`
- `internal/i18n/reltime_test.go`
- `internal/cmd/teams.go` — replaced inline `relativeTime`
- `internal/tui/project_picker.go` — replaced inline `relativeAge`

**Commit:** `refactor(i18n): consolidate relative time formatting with i18n support`

---

### Task 4: Internationalize TUI strings (labels, help, status) ✅

**Files modified:** `keys.go`, `shell.go`, `multi_viewer.go`, `session_picker.go`, `project_picker.go`, `search_input.go`, `source_picker.go`, `app_picker.go`

**Commit:** `feat(i18n): internationalize TUI user-facing strings`

---

### Task 5: Internationalize CLI output strings ✅

**Files modified:** `server.go`, `sources.go`, `apps.go`, `teams.go`, `theme.go`, `sessions.go`, `projects.go`

**Commit:** `feat(i18n): internationalize CLI output strings`

---

### Task 6: Internationalize Cobra command descriptions ✅

**Files modified:** `internal/cmd/root.go` — added `localizeCommands()` tree walk

**Commit:** `feat(i18n): localize cobra command descriptions via tree walk`

---

### Task 7: Internationalize user-facing error messages ✅

**Files modified:** `internal/cli/sessions.go`, `projects.go`, `delete.go`, `internal/cmd/server.go`, `apps.go`

**Commit:** `feat(i18n): internationalize user-facing error messages and prompts`

---

### Task 8: Add Chinese Simplified translation to validate pipeline ✅

**Files created/modified:**
- `internal/i18n/locales/zh-Hans.toml` — partial translation (~20 keys initially)
- `internal/i18n/extract_test.go` — validates Chinese and English locale loading

**Commit:** `feat(i18n): add Chinese (Simplified) translation subset, validate pipeline`

---

### Task 9: `thinkt language` command tree + full TUI i18n sweep ✅

Originally planned as a flat `thinkt language [lang]` command. Expanded into a full command tree with TUI picker and comprehensive i18n sweep of all remaining TUI strings.

**Files created:**
- `internal/tui/language_picker.go` — split-pane TUI picker with live translation preview, themed via `theme.Current()`

**Files rewritten:**
- `internal/cmd/language.go` — command tree: `get` (tag + name, `--json`), `set` (TUI picker or direct arg), `list` (display-width-aware table with `lipgloss.Width()`, `--json`)

**Files modified for command wiring:**
- `internal/cmd/root.go` — wired subcommands + `--json` flags
- `internal/i18n/i18n.go` — added `LangInfo`, `knownLanguages`, `AvailableLanguages()`, `PreviewStrings()`, `PreviewKeys()`

**Files modified for TUI i18n sweep (~60 new string keys):**
- `internal/tui/renderer.go` — User, Assistant, Thinking, Tool, Tool Result labels; "No content"
- `internal/tui/renderer_generic.go` — same labels
- `internal/tui/theme_browser.go` — "Themes", "Preview", "Loading...", help text, set success, new theme name
- `internal/tui/theme_builder.go` — "Preview", "Theme: %s", help text, Foreground/Background, "Editing: %s (%s)", save error/success, preview entry labels
- `internal/tui/shell.go` — "Sessions", "Projects", "Search", "Search: %s", "Search...", "Loading...", "No pages to display"
- `internal/tui/search_picker.go` — title with/without query, "Loading...", help key bindings
- `internal/tui/semantic_search_picker.go` — title, "Loading..."
- `internal/tui/confirm.go` — "Yes"/"No" defaults, help key bindings
- `internal/tui/model_picker.go` — "(active)" suffix, help text
- `internal/tui/multi_viewer.go` — "Match %d/%d", match help text
- `internal/tui/image.go` — "Image" label
- `internal/tui/colorpicker/colorpicker.go` — "Color Picker", "Current:", "orig", mode tabs, hex input labels, palette labels, all help texts
- `internal/i18n/locales/zh-Hans.toml` — expanded to ~160 translated keys

**Key patterns used:**
- `thinktI18n.T("key", "fallback")` for simple strings
- `thinktI18n.Tf("key", "format %s", args...)` for formatted strings
- Pad raw strings first, then apply lipgloss style (avoids ANSI width corruption)
- `lipgloss.Width()` for display-width-aware column padding (East Asian wide chars)
- `isTTY()` checks via `term.IsTerminal` for conditional styling vs plain output

**Commits:**
- `feat(i18n): add Language config field, init i18n at startup`
- `feat(i18n): localize cobra command descriptions via tree walk`
- `feat(i18n): add Chinese (Simplified) translation subset, validate pipeline`
- `feat(i18n): internationalize user-facing error messages and prompts`

---

## Performance Considerations

| Concern | Mitigation |
|---------|------------|
| `T()` called on every TUI frame render | go-i18n uses an internal message cache; `Localize()` is a hash lookup, not file I/O |
| Embedded TOML files increase binary size | One locale file is ~10-20KB; even 10 languages add < 200KB |
| `Init()` parses all locale files at startup | Happens once; parsing a few TOML files is < 1ms |
| Package-level `var` key bindings set before `Init()` | `T()` gracefully falls back to default message when localizer is nil |

## Future Work (Not in This Plan)

- Localize flag descriptions (walk `cmd.Flags()`)
- Localize template strings (`defaultSessionSummaryTemplate`)
- Add `goi18n extract` to CI to catch untranslated strings
- Add more languages (Japanese, Korean, etc.)
- Localize the `thinkt-indexer` CLI
- Right-to-left (RTL) support for Arabic/Hebrew in TUI
