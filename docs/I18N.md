# Internationalization (i18n)

Thinkt uses `go-i18n` for internationalization. Translation files are stored in `internal/i18n/locales/` as TOML files.

## How to Add a New Language

### 1. Create the Translation File
Create a new TOML file in `internal/i18n/locales/` named with the BCP 47 language tag (e.g., `es.toml` for Spanish, `fr.toml` for French).

Use `internal/i18n/locales/zh-Hans.toml` as a template, as it contains the most up-to-date list of message IDs.

### 2. Register the Language
Add the language tag and its names to the `knownLanguages` map in `internal/i18n/i18n.go`:

```go
var knownLanguages = map[string][2]string{
	"en":      {"English", "English"},
	"zh-Hans": {"简体中文", "Chinese (Simplified)"},
	"es":      {"Español", "Spanish"}, // Add your language here
}
```

### 3. Translate the Messages
Translate the strings in your new `.toml` file. The format is:

```toml
[message.id]
other = "Translated string"
```

For plural strings, use `one` and `other` keys:

```toml
[tui.viewer.sessionsCount]
one = "{{.Count}} sesión"
other = "{{.Count}} sesiones"
```

For strings with placeholders (used with `i18n.Tf`), use `%s`, `%d`, etc., as you would in Go's `fmt.Printf`.

### 4. Verify
Run `thinkt language` to see if your new language is detected and shows the correct coverage. You can switch to it using:

```bash
thinkt language set <tag>
```

Or by setting the `THINKT_LANG` environment variable:

```bash
THINKT_LANG=es thinkt
```

## Verification & Coverage

Thinkt includes a coverage test to ensure all message IDs used in the source code are translated in each locale file.

### Running the Coverage Test
To check the translation coverage for all languages, run:

```bash
go test -v ./internal/i18n/coverage_test.go
```

The test will scan `internal/` and `cmd/` for calls to `i18n.T`, `i18n.Tf`, and `i18n.Tn`, and then compare them against the keys in each `.toml` file in `internal/i18n/locales/`.

### Message ID Patterns
For the coverage test to correctly identify message IDs, they must:
- Be literal strings in the source code (dynamic keys are not supported).
- Contain at least one dot (e.g., `category.action`).
- Start with a letter and contain only alphanumeric characters or dots.

Example:
```go
i18n.T("tui.help.scrollUp", "scroll up") // Detected
i18n.T("scrollUp", "scroll up")           // NOT detected (missing dot)
```

## Translation Guidelines
- Keep the message IDs exactly as they are in the template.
- Do not translate the keys (the parts inside `[...]`).
- If a translation is missing, it will fall back to the English string provided in the code.
- **Important:** Ensure all `other` strings are on a single line. TOML strings in this project do not support unescaped newlines. If you need a newline, use `\n`.
- Use `{{.Count}}` for plural counts.
- Ensure placeholders like `%s`, `%d`, `%q` match the original string's intended format.
